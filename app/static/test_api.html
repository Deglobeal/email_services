<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Email Service Test</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, textarea, select, button { margin: 5px 0; width: 100%; padding: 8px; }
    textarea { height: 80px; }
    .response { margin-top: 10px; padding: 10px; border: 1px solid #ccc; background: #f4f4f4; white-space: pre-wrap; }
</style>
</head>
<body>
<h1>Email Service Tester</h1>

<h2>Send Email</h2>
<form id="sendEmailForm">
    <label>To:</label>
    <input type="email" id="to" required>
    
    <label>Subject:</label>
    <input type="text" id="subject" required>
    
    <label>Body:</label>
    <textarea id="body" required></textarea>
    
    <label>Request ID (optional):</label>
    <input type="text" id="request_id">
    
    <button type="submit">Send Email</button>
</form>
<div class="response" id="sendEmailResponse"></div>

<hr>

<h2>Check Status</h2>
<form id="statusForm">
    <label>Request ID:</label>
    <input type="text" id="status_request_id" required>
    <button type="submit">Check Status</button>
</form>
<div class="response" id="statusResponse"></div>

<hr>

<h2>Retry Failed</h2>
<button id="retryButton">Retry Failed Emails</button>
<div class="response" id="retryResponse"></div>

<script>
const API_BASE = ""  // leave empty if same origin

// Send Email
document.getElementById("sendEmailForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const payload = {
        to: document.getElementById("to").value,
        subject: document.getElementById("subject").value,
        body: document.getElementById("body").value,
        request_id: document.getElementById("request_id").value || null
    };
    try {
        const res = await fetch(API_BASE + "/send_email", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(payload)
        });
        const data = await res.json();
        document.getElementById("sendEmailResponse").textContent = JSON.stringify(data, null, 2);
    } catch (err) {
        document.getElementById("sendEmailResponse").textContent = err;
    }
});

// Check Status
document.getElementById("statusForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const payload = { request_id: document.getElementById("status_request_id").value };
    try {
        const res = await fetch(API_BASE + "/status", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(payload)
        });
        const data = await res.json();
        document.getElementById("statusResponse").textContent = JSON.stringify(data, null, 2);
    } catch (err) {
        document.getElementById("statusResponse").textContent = err;
    }
});

// Retry Failed
document.getElementById("retryButton").addEventListener("click", async () => {
    try {
        const res = await fetch(API_BASE + "/retry_failed", { method: "POST" });
        const data = await res.json();
        document.getElementById("retryResponse").textContent = JSON.stringify(data, null, 2);
    } catch (err) {
        document.getElementById("retryResponse").textContent = err;
    }
});
</script>
</body>
</html>
